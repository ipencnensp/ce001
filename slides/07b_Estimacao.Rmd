---
title: "Estimação: (B) Estimação por intervalo"
short-title: "Estimação: Parte B"
author: |
  | Wagner H. Bonat
  | Fernando P. Mayer
  | Elias T. Krainski
short-author: "WB, FM, EK"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
short-date: "2018/1"
institute: "Laboratório de Estatística e Geoinformação"
short-institute: "LEG/DEST/UFPR"
department: |
  | Universidade Federal do Paraná
  | Departamento de Estatística
safe-columns: true
fontfamily: inconsolata
output:
  legtheme::beamer_leg
---

```{r setup, cache=FALSE, include=FALSE}
source("setup_knitr_slides.R")
op <- par(no.readonly = TRUE)
```

# Introdução

### Estimação

Existem dois tipos de estimativas que podemos obter a partir de uma
**amostra aleatória**:

#### Estimativa pontual
Fornecem como estimativa um único valor numérico para o parâmetro de
interesse

#### Estimativa intervalar
Fornece um intervalo de valores ``plausíveis'' para o parâmetro de
interesse

### Estimação

Por serem **variáveis aleatórias**, os estimadores pontuais
possuem uma distribuição de probabilidade (distribuições amostrais).

Com isso, podemos apresentar uma estimativa mais informativa para o
parâmetro de interesse, que inclua uma medida de **precisão** do
valor obtido $\rightarrow$ **estimativa intervalar** ou
**intervalo de confiança**.

Os **intervalos de confiança** são obtidos a partir da
**distribuição amostral** de seus estimadores.

# Intervalos de confiança para a média: $\sigma$ conhecido

## IC para a média: $\sigma$ conhecido

### Suposições necessárias

- A amostra é uma **amostra aleatória simples**. (Todas as
amostras de mesmo tamanho tem a mesma probabilidade de serem selecionadas)
- O valor do desvio-padrão populacionalm $\sigma$, é conhecido
- Uma ou ambas das seguintes condições são satisfeitas:
  - A população é normalmente distribuída
  - A amostra possui $n > 30$

### Erro amostral

Quando coletamos uma **amostra aleatória** e calculamos uma
média, sabemos que o valor da média possui um desvio natural, em
relação ao verdadeiro valor da média populacional (**erro amostral**),
ou seja
$$
e = \bar{X} - \mu \quad \Rightarrow \quad \bar{X} = \mu + e
$$

Sabemos que a **distribuição amostral da média** é uma
distribuição normal, com média $\mu$ e variância
$\sigma^2/n$,
$$
\bar{X} \sim \text{N}\left(\mu, \frac{\sigma^2}{n}\right)
$$

### Margem de erro

Usando a transformação
$$
Z = \frac{\bar{X} - \mu}{\sigma/\sqrt{n}} =
\frac{e}{\sigma/\sqrt{n}} \, \sim \, \text{N}(0,1)
$$
podemos determinar o **erro máximo provável** que
assumimos para a média amostral que estamos calculando.

O **erro máximo provável** ou **margem de erro** da média é
definido por
$$
e = z_{\gamma/2} \cdot \frac{\sigma}{\sqrt{n}}
$$
onde $z_{\gamma/2}$ é chamado de **valor crítico**.

### Intervalo de confiança

Fixando um valor $\gamma$ tal que $0 < \gamma < 1$, podemos encontrar um
valor $z_{\gamma/2}$ tal que:

\begin{align*}
&P[|Z| < z_{\gamma/2}] &= \gamma \\
&P[-z_{\gamma/2} < Z < z_{\gamma/2}] &= \gamma \\
&P[-z_{\gamma/2} < \frac{\bar{x} - \mu}{\sigma/\sqrt{n}} <
z_{\gamma/2}] &= \gamma \\
&P[\bar{x} - z_{\gamma/2} \cdot
\left(\frac{\sigma}{\sqrt{n}} \right) < \mu < \bar{x} + z_{\gamma/2}
\cdot \left(\frac{\sigma}{\sqrt{n}} \right)] &= \gamma \\
&P[\bar{x} - e < \mu < \bar{x} + e] &= \gamma \\
\end{align*}

### Intervalo de confiança

O valor crítico $z_{\gamma/2}$ é o valor de $\gamma$ dividido por 2, uma
vez que a "massa" $\gamma$ deve ser distribuída igualmente em torno de 0.

```{r, out.width='80%'}
curve(dnorm, from = -4, to = 4, axes = FALSE,
      xlab = "z", ylab = "f(z)", yaxs = "i")
axis(1, at = c(-1.96, 0, 1.96),
     labels = c(expression(-z[gamma/2]), "0", expression(z[gamma/2])))
box()
cord.x <- c(-1.96, seq(-1.96, 1.96, 0.01), 1.96)
cord.y <- c(0, dnorm(seq(-1.96, 1.96, 0.01)), 0)
polygon(x = cord.x, y = cord.y, col = "lightgray", border = NA)
segments(x0 = 0, y0 = 0, x1 = 0, y1 = dnorm(0))
text(x = -0.9, y = 0.1, labels = expression(frac(symbol(gamma), 2)))
text(x = 0.9, y = 0.1, labels = expression(frac(symbol(gamma), 2)))
```

### Coeficiente de confiança $\gamma$

A área $\gamma$ determina o **coeficiente de confiança**
associado ao intervalo de confiança que estamos construindo.

O valor $z_{\gamma/2}$ pode ser obtido da tabela da Normal padrão,
localizando o valor de $\gamma/2$ no corpo da tabela e obtendo o valor
$z_{\gamma/2}$ nas margens correspondentes.

Exemplo: $\gamma = 0,95$:

- Temos que $\gamma/2 = 0,475$ é a área que devemos procurar no corpo da
  tabela
- O valor de $z_{\gamma/2}$ será determinado pelos valores
correspondentes nas margens da tabela. Nesse caso, $z_{\gamma/2} =
1,96$ é o valor crítico procurado.

### Intervalo de confiança

Com estas definições, podemos construir um **intervalo de
confiança** para $\mu$, com **coeficiente de confiança** $\gamma$:
$$
\text{IC}(\mu, \gamma) = \left[ \bar{X} - z_{\gamma/2} \cdot
  \left(\frac{\sigma}{\sqrt{n}}\right) ; \bar{X} + z_{\gamma/2} \cdot
  \left(\frac{\sigma}{\sqrt{n}}\right)  \right]
$$

Outras notações:
$$\bar{x} - e < \mu < \bar{x} + e$$
$$\bar{x} \pm e$$
$$[\bar{x} - e; \bar{x} + e]$$

### Procedimentos gerais para a construção de intervalos de confiança

1. Verifique se as suposições necessárias estão satisfeitas
   - Temos uma AAS
   - $\sigma$ é conhecido
   - A população tem distribuição normal ou $n>30$
2. Determine o nível de confiança $\gamma$, e encontre o valor crítico
  $z_{\gamma/2}$
3. Calcule a margem de erro $e = z_{\gamma/2} \cdot (\sigma/\sqrt{n})$
4. Calcule $\text{IC}(\mu, \gamma)$

### Interpretação de um intervalo de confiança

Suponha que obtivemos um intervalo de 95% de confiança:
$\text{IC}(\mu,95\%) = [52; 58]$

\begin{block}{Interpretação 1}
Temos 95\% de confiança de que a verdadeira média populacional $\mu$
se encontra entre 52 e 58
\end{block}
\begin{block}{Interpretação 2}
Temos 95\% de confiança de que o intervalo entre 52 e 58 realmente
contém a verdadeira média populacional $\mu$
\end{block}

### Interpretação de um intervalo de confiança

Suponha que obtivemos um intervalo de 95% de confiança:
$\text{IC}(\mu,95\%) = [52; 58]$

\begin{alertblock}{Interpretação 1 --- ERRADA}
Temos 95\% de confiança de que a verdadeira média populacional $\mu$
se encontra entre 52 e 58
\end{alertblock}
\begin{block}{Interpretação 2 --- CERTA}
Temos 95\% de confiança de que o intervalo entre 52 e 58 realmente
contém a verdadeira média populacional $\mu$
\end{block}

### Interpretação de um intervalo de confiança

Como o intervalo de confiança é calculado a partir de uma
**amostra aleatória**, este intervalo  **também é aleatório**!

Isso significa que para cada amostra aleatória que tivermos, um
intervalo **diferente** será calculado.

Como o valor de $\mu$ é fixo, é o intervalo que deve conter o valor de
$\mu$, e não o contrário.

Isso significa que se pudessemos obter 100 amostras diferentes, e
calcularmos um intervalo de confiança de 95% para cada uma das 100
amostras, esperariamos que 5 destes intervalos **não** contenham
o verdadeiro valor da média populacional $\mu$.

### Interpretação de um intervalo de confiança

```{r, out.width='70%', fig.width=7, fig.height=6}
library(TeachingDemos)
set.seed(201409)
ci.examp(reps = 100)
```

### Exemplo

Uma empresa de computadores deseja estimar o tempo médio de horas
semanais que as pessoas utilizam o computador.

Uma amostra aleatória de 25 pessoas apresentou um tempo médio de uso de
22,4 horas. Com base em estudos anteriores, a empresa assume que $\sigma
= 5,2$ horas, e que os tempos são normalmente distribuídos.

Construa um intervalo de confiança para a média $\mu$ com coeficiente de
confiança de 95%.

### Amplitude de um intervalo

A **amplitude** de um intervalo de confiança é dada pela
diferença entre o  limite superior e inferior, ou seja,
\begin{align*}
\text{AMP}_{IC} &=
  \left[ \bar{x} + z_{\gamma/2} \cdot
  \left( \frac{\sigma}{\sqrt{n}} \right) \right] -
  \left[ \bar{x} - z_{\gamma/2} \cdot
  \left( \frac{\gamma}{\sqrt{n}} \right) \right] \\
 &= 2 \times z_{\gamma/2} \cdot (\sigma/\sqrt{n})
\end{align*}

- Note que, claramente, um intervalo de confiança depende conjuntamente
de três componentes:
   - Coeficiente de confiança $\gamma$, expresso pelo valor crítico
    $z_{\gamma/2}$
   - Desvio-padrão populacional $\sigma$
   - Tamanho da amostra $n$

### Amplitude de um intervalo

$z_{\gamma/2} \rightarrow$ Cada vez que aumentamos a confiança $\gamma$,
o valor de $z_{\gamma/2}$ fica maior, e consequentemente a amplitude do
intervalo aumenta.

$\sigma \rightarrow$ Um grande desvio padrão indica a possibilidade de
um considerável distanciamento dos valores amostrais em relação à média
populacional

$n \rightarrow$ Quanto maior for o tamanho da amostra, maior será a
quantidade de informação disponível. Com isso, valores maiores de $n$
produzem intervalos mais informativos

### Exemplo

Seja $X \sim \text{N}(\mu, 36)$

a) Para uma amostra de tamanho 50, obtivemos média amostral
18,5. Construa intervalos de confiança de
   - $(i)\ 90\% \quad (ii)\ 95\% \quad (iii)\ 99\%$
b) Calcule as amplitudes dos intervalos acima e explique a
diferença.
c) Para um nível de confiança de 95%, construa intervalos de
confiança (admita a mesma média amostral 18,5) supondo tamanhos de
amostra
   - $(i)\ n = 15 \quad (ii)\ n = 100$
d) Calcule as amplitudes dos intervalos acima e explique a
diferença.

## Determinação do tamanho amostral

### Determinação do tamanho amostral

Nosso objetivo é coletar dados para estimar a **média populacional**
$\mu$.

A questão é:

> **Quantos elementos (itens, objetos, pessoas, ...) devemos amostrar?**

Já vimos que, de maneira (bem) geral, $n>30$ é um tamanho de amostra
mínimo para a maioria dos casos.

Será que podemos ter uma estimativa melhor de quantos elementos
devem ser amostrados para estimarmos a média populacional com uma
precisão conhecida?

### Determinação do tamanho amostral

A partir da equação do **erro máximo provável**
$$
e = z_{\gamma/2} \cdot \frac{\sigma}{\sqrt{n}}
$$
podemos isolar $n$ e chegar na seguinte equação para a determinação do
tamanho amostral
$$
n = \left[ \frac{z_{\alpha/2} \cdot \sigma}{e} \right]^2
$$

### Determinação do tamanho amostral

Note que, em
$$
n = \left[ \frac{z_{\alpha/2} \cdot \sigma}{e} \right]^2
$$

- O tamanho amostral $n$ **não** depende do tamanho
populacional $N$
- O tamanho amostral depende:
   - do nível de confiança desejado (expresso pelo valor crítico
   $z_{\alpha/2}$)
   - do erro máximo \textsl{desejado}
   - do desvio-padrão $\sigma$ (embora veremos que não é
   estritamente necessário)
- Como o tamanho amostral precisa ser um número inteiro,
arredondamos sempre o valor para o **maior** número inteiro
mais próximo

### Exemplo

Seja $X \sim \text{N}(\mu,36)$

a) Calcule o tamanho da amostra, para que com 95\% de probabilidade, a
média amostral não difira da média populacional por mais de
   - $(i)\ 0,5 \text{ unidades} \quad (ii)\ 2 \text{ unidades}$
b) Qual o impacto do erro máximo assumido para o tamanho da
amostra?
c) Calcule o tamanho da amostra, para que a diferença da média
amostral para a média populacional (em valor absoluto) seja menor ou
igual a 2 unidades, com níveis de confiança de
   - $(i)\ 90\% \quad (ii)\ 95\%$
d) Compare as estimativas do item anterior e analise o impacto
do nível de confiança para a determinação do tamanho amostral.
